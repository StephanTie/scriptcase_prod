# scriptcase_prod
Docker-compose scriptcase php-apps in nginx, mysql, phpmyadmin and phhp-fpm in production 

![This is an image](https://repository-images.githubusercontent.com/283847593/7454bc80-1bab-11eb-83fa-bb2f2e6f258f)


**How to install Scriptcase generated php applications on docker with nginx-proxy using nginx and mysql with ssl access **
date: 15–11–2021

**Introduction**
This manual describes how to get your applications generated by scriptcase into production using docker with nginx-proxy, letsencrypt, nginx and mysql.
The standard installed application is a demo application from scriptcase.
It is running on ubuntu 18 and requires docker, docker-compose and ufw installed. Explanation how to install these you can easily find here or the other many manuals. Furthermore ensure that your servers and I like to stress this again and again if you use your applications exposed to the outside world are extremely hardened . (you can find enough examples of them with google)
Objective is to have the generated scriptcase php-applications accessible through the nginx-proxy protected by a certificate. Also I liked to have the benefit to test an older version and a new version of the generated scriptcase application in the same environment .
Prerequisites
Starting point: Ensure versions are equal or higher for:
- Ubuntu 18.04.4 LTS with ufw installed 
- docker version 18.09.7
- docker-compose 1.29.2

Ensure your production environment is safe and hardened otherwise  you get your data exposed. (ufw is up, fail2ban, sudo and no root users, ssh only with key and many other safety precautions steps you should  be familiar with)

With having this docker environment set up it is very easy to spin up an new copy of an environment and set up a stage environment.
Also new versions of scriptcase with new versions of php , nginx and mysql can be far more easily installed and tested.

**Steps**
Step 1 - Precautions for automatic iptable changes by docker.
When using docker first of all you do not want starting containers automatically opening ports and change the iptables. Also added standard dns.
edit daemon.json: sudo vi /etc/docker/daemon.json
{ "iptables" : false }
{ "dns": ["8.8.8.8", "8.8.8.4"] }
restart docker:
sudo systemctl start docker

Step 2 - Starting up nginx-proxy and letsencrypt-nginx-proxy-companion
Follow the steps defined on  https://github.com/StephanTie/nginx-proxy-letsencrypt

Step 3 - Ensure you have an A record pointing to your server 
project1.domain.com -> 111.222.333.444

Step 4 - Copy .env.template to .env and change the .env file
cp .env.template .env
edit .env file and change all the items that have a mark changeme.
Do not change the other settings. Do this later after the first initial run works

Step 5 Run install for project1
sudo firststeponly.sh 1

Step 6 Configure Scriptcase production Go to https://project1.domain.com/_lib/prod
- Login with scriptcase and set new password 
- edit database connection option conn_example and change Server/Host to mysql-project and save
![afbeelding](https://user-images.githubusercontent.com/8845918/147996147-8448611b-33e6-4878-b6f8-8b304a215315.png)
- Now you can browse to https://project1.<domain.com>   for which you fil in your domain

** Special options  **
1. Automatic updates in case updates are pushed to directory app_install/project{1..n} or directory mysql_install or with help of the pure-ftpd server (see project pureftpd)
Start automatic update process  (change /data/docker to your directory where your project reside)
- screen -dmS PUBLISH_SCRIPTCASE  /data/docker/scriptcase_prod/publish_scriptcase.sh


